/*
 * problem.h --- e2fsck problem error codes
 *
 * Copyright 1996 by Theodore Ts'o
 *
 * %Begin-Header%
 * This file may be redistributed under the terms of the GNU Public
 * License.
 * %End-Header%
 */

typedef __u32 problem_t;

struct problem_context {
	errcode_t	errcode;
	ext2_ino_t ino, ino2, dir;
	struct ext2_inode *inode;
	struct ext2_dir_entry *dirent;
	blk64_t	blk, blk2;
	e2_blkcnt_t	blkcount;
	int		group;
	__u64	num;
	const char *str;
};

#define PR_LATCH_MASK	0x0ff0  
#define PR_LATCH_BLOCK	0x0010	
#define PR_LATCH_BBLOCK	0x0020	
#define PR_LATCH_IBITMAP 0x0030 
#define PR_LATCH_BBITMAP 0x0040 
#define PR_LATCH_RELOC	0x0050  
#define PR_LATCH_DBLOCK	0x0060	
#define PR_LATCH_LOW_DTIME 0x0070 
#define PR_LATCH_TOOBIG	0x0080	
#define PR_LATCH_OPTIMIZE_DIR 0x0090 
#define PR_LATCH_BG_CHECKSUM 0x00A0  

#define PR_LATCH(x)	((((x) & PR_LATCH_MASK) >> 4) - 1)

#define PRL_YES		0x0001	
#define PRL_NO		0x0002	
#define PRL_LATCHED	0x0004	
#define PRL_SUPPRESS	0x0008	

#define PRL_VARIABLE	0x000f	


#define PR_0_BB_NOT_GROUP	0x000001

#define PR_0_IB_NOT_GROUP	0x000002

#define PR_0_ITABLE_NOT_GROUP	0x000003

#define PR_0_SB_CORRUPT		0x000004

#define PR_0_FS_SIZE_WRONG	0x000005

#define PR_0_NO_FRAGMENTS	0x000006

#define PR_0_BLOCKS_PER_GROUP	0x000007

#define PR_0_FIRST_DATA_BLOCK	0x000008

#define PR_0_ADD_UUID		0x000009

#define PR_0_RELOCATE_HINT	0x00000A

#define PR_0_MISC_CORRUPT_SUPER	0x00000B

#define PR_0_GETSIZE_ERROR	0x00000C

#define PR_0_INODE_COUNT_WRONG	0x00000D

#define PR_0_HURD_CLEAR_FILETYPE 0x00000E

#define PR_0_JOURNAL_BAD_INODE	0x00000F

#define PR_0_JOURNAL_UNSUPP_MULTIFS 0x000010

#define PR_0_CANT_FIND_JOURNAL	0x000011

#define PR_0_EXT_JOURNAL_BAD_SUPER 0x000012

#define PR_0_JOURNAL_BAD_UUID	0x000013

#define PR_0_JOURNAL_UNSUPP_SUPER 0x000014

#define PR_0_JOURNAL_BAD_SUPER	0x000015

#define PR_0_JOURNAL_HAS_JOURNAL 0x000016

#define PR_0_JOURNAL_RECOVER_SET 0x000017

#define PR_0_JOURNAL_RECOVERY_CLEAR 0x000018

#define PR_0_JOURNAL_RESET_JOURNAL 0x000019

#define PR_0_FS_REV_LEVEL	0x00001A

#define PR_0_ORPHAN_CLEAR_INODE			0x000020

#define PR_0_ORPHAN_ILLEGAL_BLOCK_NUM		0x000021

#define PR_0_ORPHAN_ALREADY_CLEARED_BLOCK	0x000022

#define PR_0_ORPHAN_ILLEGAL_HEAD_INODE		0x000023

#define PR_0_ORPHAN_ILLEGAL_INODE		0x000024

#define PR_0_JOURNAL_UNSUPP_ROCOMPAT		0x000025

#define PR_0_JOURNAL_UNSUPP_INCOMPAT		0x000026

#define PR_0_JOURNAL_UNSUPP_VERSION		0x000027

#define	PR_0_MOVE_JOURNAL			0x000028

#define	PR_0_ERR_MOVE_JOURNAL			0x000029

#define PR_0_CLEAR_V2_JOURNAL			0x00002A

#define PR_0_JOURNAL_RUN			0x00002B

#define PR_0_JOURNAL_RUN_DEFAULT		0x00002C

#define PR_0_BACKUP_JNL				0x00002D

#define PR_0_NONZERO_RESERVED_GDT_BLOCKS	0x00002E

#define PR_0_CLEAR_RESIZE_INODE			0x00002F

#define PR_0_RESIZE_INODE_INVALID		0x000030

#define PR_0_FUTURE_SB_LAST_MOUNT		0x000031

#define PR_0_FUTURE_SB_LAST_WRITE		0x000032

#define PR_0_EXTERNAL_JOURNAL_HINT		0x000033

#define PR_0_DIRHASH_HINT			0x000034

#define PR_0_GDT_CSUM				0x000035

#define PR_0_GDT_UNINIT				0x000036

#define PR_0_BB_UNINIT_IB_INIT			0x000037

#define PR_0_GDT_ITABLE_UNUSED			0x000038

#define PR_0_BB_UNINIT_LAST			0x000039

#define PR_0_JNL_TXN_CORRUPT			0x00003A

#define PR_0_CLEAR_TESTFS_FLAG			0x00003B

#define PR_0_FUTURE_SB_LAST_MOUNT_FUDGED	0x00003C

#define PR_0_FUTURE_SB_LAST_WRITE_FUDGED	0x00003D

#define PR_0_GDT_CSUM_LATCH			0x00003E



#define PR_1_PASS_HEADER		0x010000

#define PR_1_ROOT_NO_DIR		0x010001

#define PR_1_ROOT_DTIME			0x010002

#define PR_1_RESERVED_BAD_MODE		0x010003

#define PR_1_ZERO_DTIME			0x010004

#define PR_1_SET_DTIME			0x010005

#define PR_1_ZERO_LENGTH_DIR		0x010006

#define PR_1_BB_CONFLICT		0x010007

#define PR_1_IB_CONFLICT		0x010008

#define PR_1_ITABLE_CONFLICT		0x010009

#define PR_1_BB_BAD_BLOCK		0x01000A

#define PR_1_IB_BAD_BLOCK		0x01000B

#define PR_1_BAD_I_SIZE			0x01000C

#define PR_1_BAD_I_BLOCKS		0x01000D

#define PR_1_ILLEGAL_BLOCK_NUM		0x01000E

#define PR_1_BLOCK_OVERLAPS_METADATA	0x01000F

#define PR_1_INODE_BLOCK_LATCH		0x010010

#define	PR_1_TOO_MANY_BAD_BLOCKS	0x010011

#define PR_1_BB_ILLEGAL_BLOCK_NUM	0x010012

#define PR_1_INODE_BBLOCK_LATCH		0x010013

#define PR_1_DUP_BLOCKS_PREENSTOP	0x010014

#define PR_1_BBINODE_BAD_METABLOCK	0x010015

#define PR_1_BBINODE_BAD_METABLOCK_PROMPT 0x010016

#define PR_1_BAD_PRIMARY_BLOCK		0x010017

#define PR_1_BAD_PRIMARY_BLOCK_PROMPT	0x010018

#define PR_1_BAD_PRIMARY_SUPERBLOCK	0x010019

#define PR_1_BAD_PRIMARY_GROUP_DESCRIPTOR 0x01001A

#define PR_1_BAD_SUPERBLOCK		0x01001B

#define PR_1_BAD_GROUP_DESCRIPTORS	0x01001C

#define PR_1_PROGERR_CLAIMED_BLOCK	0x01001D

#define PR_1_RELOC_BLOCK_ALLOCATE	0x01001E

#define PR_1_RELOC_MEMORY_ALLOCATE	0x01001F

#define PR_1_RELOC_FROM_TO		0x010020

#define PR_1_RELOC_TO			0x010021

#define PR_1_RELOC_READ_ERR		0x010022

#define PR_1_RELOC_WRITE_ERR		0x010023

#define PR_1_ALLOCATE_IBITMAP_ERROR	0x010024

#define PR_1_ALLOCATE_BBITMAP_ERROR	0x010025

#define PR_1_ALLOCATE_ICOUNT		0x010026

#define PR_1_ALLOCATE_DBCOUNT		0x010027

#define PR_1_ISCAN_ERROR		0x010028

#define PR_1_BLOCK_ITERATE		0x010029

#define PR_1_ICOUNT_STORE		0x01002A

#define PR_1_ADD_DBLOCK			0x01002B

#define PR_1_READ_INODE			0x01002C

#define PR_1_SUPPRESS_MESSAGES		0x01002D

#define PR_1_SET_IMAGIC			0x01002F

#define PR_1_SET_IMMUTABLE		0x010030

#define PR_1_COMPR_SET			0x010031

#define PR_1_SET_NONZSIZE		0x010032

#define PR_1_FS_REV_LEVEL		0x010033

#define PR_1_JOURNAL_INODE_NOT_CLEAR	0x010034

#define PR_1_JOURNAL_BAD_MODE		0x010035

#define PR_1_LOW_DTIME			0x010036

#define PR_1_ORPHAN_LIST_REFUGEES	0x010037

#define PR_1_ALLOCATE_REFCOUNT		0x010038

#define PR_1_READ_EA_BLOCK		0x010039

#define PR_1_BAD_EA_BLOCK		0x01003A

#define PR_1_EXTATTR_READ_ABORT		0x01003B

#define PR_1_EXTATTR_REFCOUNT		0x01003C

#define PR_1_EXTATTR_WRITE_ABORT	0x01003D

#define PR_1_EA_MULTI_BLOCK		0x01003E

#define PR_1_EA_ALLOC_REGION_ABORT	0x01003F

#define PR_1_EA_ALLOC_COLLISION		0x010040

#define PR_1_EA_BAD_NAME		0x010041

#define PR_1_EA_BAD_VALUE		0x010042

#define PR_1_INODE_TOOBIG		0x010043

#define PR_1_TOOBIG_DIR			0x010044

#define PR_1_TOOBIG_REG			0x010045

#define PR_1_TOOBIG_SYMLINK		0x010046

#define PR_1_HTREE_SET			0x010047

#define PR_1_HTREE_NODIR		0x010048

#define PR_1_HTREE_BADROOT		0x010049

#define PR_1_HTREE_HASHV		0x01004A

#define PR_1_HTREE_INCOMPAT		0x01004B

#define PR_1_HTREE_DEPTH		0x01004C

#define PR_1_BB_FS_BLOCK		0x01004D

#define PR_1_RESIZE_INODE_CREATE	0x01004E

#define PR_1_EXTRA_ISIZE		0x01004F

#define PR_1_ATTR_NAME_LEN		0x010050

#define PR_1_ATTR_VALUE_OFFSET		0x010051

#define PR_1_ATTR_VALUE_BLOCK		0x010052

#define PR_1_ATTR_VALUE_SIZE		0x010053

#define PR_1_ATTR_HASH			0x010054

#define PR_1_TREAT_AS_DIRECTORY		0x010055

#define PR_1_READ_EXTENT		0x010056

#define PR_1_EXTENT_ITERATE_FAILURE	0x010057

#define PR_1_EXTENT_BAD_START_BLK	0x010058

#define PR_1_EXTENT_ENDS_BEYOND		0x010059

#define PR_1_EXTENTS_SET		0x01005A

#define PR_1_EXTENT_FEATURE		0x01005B

#define PR_1_UNSET_EXTENT_FL		0x01005C

#define PR_1_FAST_SYMLINK_EXTENT_FL	0x01005D

#define PR_1_OUT_OF_ORDER_EXTENTS	0x01005E

#define PR_1_EXTENT_HEADER_INVALID	0x01005F



#define PR_1B_PASS_HEADER	0x011000

#define PR_1B_DUP_BLOCK_HEADER	0x011001

#define PR_1B_DUP_BLOCK		0x011002

#define PR_1B_DUP_BLOCK_END	0x011003

#define PR_1B_ISCAN_ERROR	0x011004

#define PR_1B_ALLOCATE_IBITMAP_ERROR 0x011005

#define PR_1B_BLOCK_ITERATE	0x011006

#define PR_1B_ADJ_EA_REFCOUNT	0x011007


#define PR_1C_PASS_HEADER	0x012000


#define PR_1D_PASS_HEADER	0x013000

#define PR_1D_DUP_FILE		0x013001

#define PR_1D_DUP_FILE_LIST	0x013002

#define PR_1D_SHARE_METADATA	0x013003

#define PR_1D_NUM_DUP_INODES	0x013004

#define PR_1D_DUP_BLOCKS_DEALT	0x013005

#define PR_1D_CLONE_QUESTION	0x013006

#define PR_1D_DELETE_QUESTION	0x013007

#define PR_1D_CLONE_ERROR	0x013008


#define PR_2_PASS_HEADER	0x020000

#define PR_2_BAD_INODE_DOT	0x020001

#define PR_2_BAD_INO		0x020002

#define PR_2_UNUSED_INODE	0x020003

#define PR_2_LINK_DOT		0x020004

#define PR_2_BB_INODE		0x020005

#define PR_2_LINK_DIR		0x020006

#define PR_2_LINK_ROOT		0x020007

#define PR_2_BAD_NAME		0x020008

#define PR_2_MISSING_DOT	0x020009

#define PR_2_MISSING_DOT_DOT	0x02000A

#define PR_2_1ST_NOT_DOT	0x02000B

#define PR_2_2ND_NOT_DOT_DOT	0x02000C

#define PR_2_FADDR_ZERO		0x02000D

#define PR_2_FILE_ACL_ZERO	0x02000E

#define PR_2_DIR_ACL_ZERO	0x02000F

#define PR_2_FRAG_ZERO		0x020010

#define PR_2_FSIZE_ZERO		0x020011

#define PR_2_BAD_MODE		0x020012

#define PR_2_DIR_CORRUPTED	0x020013

#define PR_2_FILENAME_LONG	0x020014

#define PR_2_DIRECTORY_HOLE	0x020015

#define PR_2_DOT_NULL_TERM	0x020016

#define PR_2_DOT_DOT_NULL_TERM	0x020017

#define PR_2_BAD_CHAR_DEV	0x020018

#define PR_2_BAD_BLOCK_DEV	0x020019

#define PR_2_DUP_DOT		0x02001A

#define PR_2_DUP_DOT_DOT	0x02001B

#define PR_2_NO_DIRINFO		0x02001C

#define PR_2_FINAL_RECLEN	0x02001D

#define PR_2_ALLOCATE_ICOUNT	0x02001E

#define PR_2_DBLIST_ITERATE	0x02001F

#define PR_2_READ_DIRBLOCK	0x020020

#define PR_2_WRITE_DIRBLOCK	0x020021

#define PR_2_ALLOC_DIRBOCK	0x020022

#define PR_2_DEALLOC_INODE	0x020023

#define PR_2_SPLIT_DOT		0x020024

#define PR_2_BAD_FIFO		0x020025

#define PR_2_BAD_SOCKET		0x020026

#define PR_2_SET_FILETYPE	0x020027

#define PR_2_BAD_FILETYPE	0x020028

#define PR_2_CLEAR_FILETYPE	0x020029

#define PR_2_NULL_NAME		0x020030

#define PR_2_INVALID_SYMLINK	0x020031

#define PR_2_FILE_ACL_BAD	0x020032

#define PR_2_FEATURE_LARGE_FILES 0x020033

#define PR_2_HTREE_NOTREF	0x020034

#define PR_2_HTREE_DUPREF	0x020035

#define PR_2_HTREE_MIN_HASH	0x020036

#define PR_2_HTREE_MAX_HASH	0x020037

#define PR_2_HTREE_CLEAR	0x020038


#define PR_2_HTREE_BADBLK	0x02003A

#define PR_2_ADJ_EA_REFCOUNT	0x02003B

#define PR_2_HTREE_BAD_ROOT	0x02003C

#define PR_2_HTREE_BAD_LIMIT	0x02003D

#define PR_2_HTREE_BAD_COUNT	0x02003E

#define PR_2_HTREE_HASH_ORDER	0x02003F

#define PR_2_HTREE_BAD_DEPTH	0x020040

#define PR_2_DUPLICATE_DIRENT	0x020041

#define PR_2_NON_UNIQUE_FILE	0x020042

#define PR_2_REPORT_DUP_DIRENT	0x020043

#define PR_2_BLOCKS_HI_ZERO	0x020044

#define PR_2_UNEXPECTED_HTREE_BLOCK	0x020045

#define PR_2_INOREF_BG_INO_UNINIT	0x020046

#define PR_2_INOREF_IN_UNUSED		0x020047

#define PR_2_I_FILE_ACL_HI_ZERO		0x020048


#define PR_3_PASS_HEADER		0x030000

#define PR_3_NO_ROOT_INODE		0x030001

#define PR_3_EXPAND_LF_DIR		0x030002

#define PR_3_UNCONNECTED_DIR		0x030003

#define PR_3_NO_LF_DIR			0x030004

#define PR_3_BAD_DOT_DOT		0x030005

#define PR_3_NO_LPF			0x030006

#define PR_3_CANT_EXPAND_LPF		0x030007

#define PR_3_CANT_RECONNECT		0x030008

#define PR_3_ERR_FIND_LPF		0x030009

#define PR_3_ERR_LPF_NEW_BLOCK		0x03000A

#define PR_3_ERR_LPF_NEW_INODE		0x03000B

#define PR_3_ERR_LPF_NEW_DIR_BLOCK	0x03000C

#define PR_3_ERR_LPF_WRITE_BLOCK	0x03000D

#define PR_3_ADJUST_INODE		0x03000E

#define PR_3_FIX_PARENT_ERR		0x03000F

#define PR_3_FIX_PARENT_NOFIND		0x030010

#define PR_3_ALLOCATE_IBITMAP_ERROR	0x030011

#define PR_3_CREATE_ROOT_ERROR		0x030012

#define PR_3_CREATE_LPF_ERROR		0x030013

#define PR_3_ROOT_NOT_DIR_ABORT		0x030014

#define PR_3_NO_ROOT_INODE_ABORT	0x030015

#define PR_3_NO_DIRINFO			0x030016

#define PR_3_LPF_NOTDIR			0x030017

#define PR_3A_PASS_HEADER		0x031000

#define PR_3A_OPTIMIZE_ITER		0x031001

#define PR_3A_OPTIMIZE_DIR_ERR		0x031002

#define PR_3A_OPTIMIZE_DIR_HEADER	0x031003

#define PR_3A_OPTIMIZE_DIR		0x031004

#define PR_3A_OPTIMIZE_DIR_END		0x031005


#define PR_4_PASS_HEADER		0x040000

#define PR_4_ZERO_LEN_INODE		0x040001

#define PR_4_UNATTACHED_INODE		0x040002

#define PR_4_BAD_REF_COUNT		0x040003

#define PR_4_INCONSISTENT_COUNT		0x040004


#define PR_5_PASS_HEADER		0x050000

#define PR_5_INODE_BMAP_PADDING		0x050001

#define PR_5_BLOCK_BMAP_PADDING		0x050002

#define PR_5_BLOCK_BITMAP_HEADER	0x050003

#define PR_5_BLOCK_UNUSED		0x050004

#define PR_5_BLOCK_USED			0x050005

#define PR_5_BLOCK_BITMAP_END		0x050006

#define PR_5_INODE_BITMAP_HEADER	0x050007

#define PR_5_INODE_UNUSED		0x050008

#define PR_5_INODE_USED			0x050009

#define PR_5_INODE_BITMAP_END		0x05000A

#define PR_5_FREE_INODE_COUNT_GROUP	0x05000B

#define PR_5_FREE_DIR_COUNT_GROUP	0x05000C

#define PR_5_FREE_INODE_COUNT		0x05000D

#define PR_5_FREE_BLOCK_COUNT_GROUP	0x05000E

#define PR_5_FREE_BLOCK_COUNT		0x05000F

#define PR_5_BMAP_ENDPOINTS		0x050010

#define PR_5_FUDGE_BITMAP_ERROR		0x050011

#define PR_5_COPY_IBITMAP_ERROR		0x050012

#define PR_5_COPY_BBITMAP_ERROR		0x050013

#define PR_5_BLOCK_RANGE_UNUSED		0x050014

#define PR_5_BLOCK_RANGE_USED		0x050015

#define PR_5_INODE_RANGE_UNUSED		0x050016

#define PR_5_INODE_RANGE_USED		0x050017

#define PR_5_BLOCK_UNINIT		0x050018

#define PR_5_INODE_UNINIT		0x050019


#define PR_6_RECREATE_JOURNAL		0x060001

int fix_problem(e2fsck_t ctx, problem_t code, struct problem_context *pctx);
int end_problem_latch(e2fsck_t ctx, int mask);
int set_latch_flags(int mask, int setflags, int clearflags);
int get_latch_flags(int mask, int *value);
void clear_problem_context(struct problem_context *pctx);

void print_e2fsck_message(e2fsck_t ctx, const char *msg,
			  struct problem_context *pctx, int first,
			  int recurse);

